<?
/**
 * Class Model
 * Создает подключение к БД
 * Дает доступ к моделям через свойства екземпляка класса
 *      Пример:
 *      $model = new System_Model();
 *      $users = $model->users;
 *
 * @author Anton Tovstenko *
 */
class  System_Model
{

    /**
     * Адрес хранения моделей
     * @var string
     */
    private $_dir = '/model/';


    /**
     * Экземпляр компонента для работи в ДБ
     * @var Component_Db
     */
    protected  $db;


    /**
     * Созданные объекты моделей
     * @var array
     */
    private static $objects = array();


    /**
     * Конструктор модели
     */
    public function __construct()
    {
        $this->db = Component_Db::getInstance();
    }


    /**
     * Магический метод, создает нужный объект Модели
     * @param $name
     * @return mixed
     */
    public function __get($name)
	{
		// Если такой объект уже существует, возвращаем его
		if (isset(self::$objects[$name])) {
			return(self::$objects[$name]);
		}
		
		// Определяем имя нужного класса
		$class = ucfirst(strtolower($name));
        $path  = ROOT.$this->_dir.$class.'.php';
        
        if(!file_exists($path))
            die("Модель <strong>$class</strong> не существует!");
		
		// Подключаем его
		include_once($path);

		// Сохраняем для будущих обращений к нему
		self::$objects[$name] = new $class();

		// Возвращаем созданный объект
		return self::$objects[$name];
	}   


}
